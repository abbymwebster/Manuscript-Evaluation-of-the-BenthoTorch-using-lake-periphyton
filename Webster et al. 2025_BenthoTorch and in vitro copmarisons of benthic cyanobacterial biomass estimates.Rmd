---
title: "Cyano biomass BenthoTorch and in vitro comparison"
author: "Abby Webster"
date: "2025-10-09"
output: html_document
---

This R Markdown file contains the code used for statistical analyses and data visualization in Webster et al. 2025 "Evaluation of the BenthoTorch using lake periphyton: A comparison of attached cyanobacterial biomass estimates" submitted to L&O Methods. 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
getwd()

library(tidyverse)
library(glmmTMB)
library(lme4)
library(ggplot2)
library(ggpubr)
library(dplyr)
library(rstatix)
library(devtools)
library(RColorBrewer)
library(viridis)
library(ggnewscale)
library(ggbreak)
```

Input data
```{r}
metadata<-read.csv("BT pigments 21-22 for R v3.csv")
```

```{r}
Cayuga<- metadata %>% filter(Lake == "Cayuga")
Canandaigua <- metadata %>% filter(Lake == "Canandaigua")
Honeoye <- metadata %>% filter(Lake == "Honeoye")

nrow(Cayuga)#50
nrow(Canandaigua)#11
nrow(Honeoye)#21
```

```{r}
PEdetects<- metadata %>% filter(PE.ug.g.detected == "Yes")
```
___ 


**Figure 2**
Comparison of extracted PC and PE in samples where PE was detected.
```{r}
glm(formula = PC.ug.cm2 ~ PE.ug.cm2, family = Gamma(link = "log"), data = PEdetects)
summary(glm(formula = PC.ug.cm2 ~ PE.ug.cm2, family = Gamma(link = "log"), data = PEdetects))
residuals(glm(formula = PC.ug.cm2 ~ PE.ug.cm2, family = Gamma(link = "log"), data = PEdetects))#significant relationship
qqnorm(residuals(glm(formula = PC.ug.cm2 ~ PE.ug.cm2, family = Gamma(link = "log"), data =   
                       PEdetects)))
qqline(residuals(glm(formula = PC.ug.cm2 ~ PE.ug.cm2, family = Gamma(link = "log"), data = 
                       PEdetects)))
performance::r2(glm(formula = PC.ug.cm2 ~ PE.ug.cm2, family = Gamma(link = "log"), data = 
                      PEdetects)) # R2 for Generalized Linear Regression
                                      #Nagelkerke's R2: 0.681

coef2<-coef(glm(formula = PC.ug.cm2 ~ PE.ug.cm2, family = Gamma(link = "log"), data = PEdetects))[2]
coef2 #expected to be linear, but not 1:1
```
```{r}
#GLM > PE and PC for samples where PE was detected. Color by Percent Cyano on BT
ggsave("PC vs PE for PE detects, color by Percent Cyano on BT.pdf", width = 8, height = 5, units = "in")
ggplot(PEdetects, aes(x =PE.ug.cm2, y = PC.ug.cm2)) + geom_point(aes(fill = Perc.Cyano.BT), shape = 21, size = 3.5, color = "black") + 
  scale_fill_distiller(palette = "GnBu", direction = 1) +  
  geom_smooth(method = "glm", method.args = list(family = Gamma(link = "log")), se = FALSE, color = 'black', size = 1) + theme_classic2() + 
  xlab(expression(paste("Avg Extracted Phycoerythrin (µg/cm" ^ "2" * ")"))) + 
  ylab(expression(paste("Cyanobacteria Chl-",italic("a "),"(µg/cm" ^ "2" * ") BenthoTorch"))) +
  labs(fill = "% Cyanobacteria") + theme(axis.text = element_text(size = 11, color = "black"))
dev.off()
```

--- 
**Figure 3**
Comparison of total Chl-a between BenthoTorch and in vitro fluorometry
*Proof of concept*
```{r}
glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = metadata)
summary(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = 
              metadata))#highly significant relationship between extracted Chla and BT       
                        #estimate of total Chla
residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = 
                metadata))
qqnorm(residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data
                     = metadata)))
qqline(residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data
                     = metadata)))
performance::r2(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data =
                      metadata))# R2 for Generalized Linear Regression
                                     #Nagelkerke's R2: 0.597
F3slope<- coef(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = metadata))[2]
F3slope  #slope = 0.797 
```
The exponential slope = 0.80, so e^0.8 = 2.23. This means that for every one unit increase in in BenthoTorch Chla, there was a 2.23 increase in fluorometric Chla (extracted).

```{r}
ggsave("Sum Chl-a comparison.pdf", width = 8, height = 5, units = "in")
ggplot(metadata, aes(x =Chla.ug.cm2, y = Sum.BT.Chla)) + geom_point(aes(fill = Mass.per.Area.Scraped.g.cm2), shape = 21, size = 3, color = "black") + 
  scale_fill_distiller(palette = "Greens", direction = 1) +  
  geom_smooth(method = "glm", method.args = list(family = Gamma(link = "log")), se = FALSE, color = 'black', size = 1)+ theme_classic2() + 
  ylab(expression(paste("Sum Chl-",italic("a "),"(µg/cm" ^ "2" * ") BenthoTorch"))) + 
  xlab(expression(paste("Avg Extracted Chl-",italic("a "), "(µg/cm" ^ "2" * ") EPA Method 445.0"))) + 
  labs(fill = expression(paste("Periphyton (g/cm" ^ "2"* ")"))) + theme(axis.text = element_text(size = 11, color = "black")) + geom_abline(intercept = 0, slope = exp(1), color = "gray", linetype = "dashed", size = 1)
dev.off()
```
---
**Figure 4**
Cyano Chla from BenthoTorch and extracted PC. All samples
```{r}
glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = metadata)
summary(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
              metadata))#this is a highly significant relationship
residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = metadata))
qqnorm(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                       metadata)))
qqline(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                       metadata)))
performance::r2(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                      metadata))# R2 for Generalized Linear Regression
                                      #Nagelkerke's R2: 0.211
coef4<-coef(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = metadata))[2]
coef4 #1.46 = exponential slope. 
```
PE-detects only
```{r}
glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = PEdetects)
summary(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = PEdetects))#this is significant
residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = PEdetects))
qqnorm(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data =
                       PEdetects)))
qqline(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data =
                       PEdetects)))
performance::r2(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data =
                      PEdetects))# R2 for Generalized Linear Regression
                                      #Nagelkerke's R2: 0.414

PEcoef<-coef(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = PEdetects))[2]
PEcoef #2.35 = exponential slope. So a one unit increase in BenthoTorch cyano Chla, there is a 10.48 increase in extracted PC.
```

Non-PE detects (i.e. PC only)
```{r}
PConly<- metadata %>% filter(PE.ug.g.detected == "No")

glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = PConly)
summary(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = PConly))#this is a significant relationship
residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = PConly))
qqnorm(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data =
                       PConly)))
qqline(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data =
                       PConly)))
performance::r2(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data =
                      PConly))# R2 for Generalized Linear Regression
                                      #Nagelkerke's R2: 0.103
PCcoef<-coef(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = PConly))[2]
PCcoef #exponential slope = 0.91, so this relationship is better when using slope as reference. A one unit increase in BenthoTorch cyano Chla corresponds with a 2.48x increase in extracted PC in samples where no PE was detected.
```

```{r}
ggsave("PC vs BT Cyano Chla.pdf", width = 8, height = 5, units = "in")
ggplot(metadata, aes(x =PC.ug.cm2, y = Cyano.Chla, linetype = PE.ug.g.detected)) + 
  geom_point(aes(fill = factor(PE.ug.g.detected, levels = c("Yes", "No"))), shape = 21, size = 3, color = "black") + 
  scale_fill_manual(values = c("tomato2", "cadetblue2")) + 
  geom_smooth(method = "glm", method.args = list(family = Gamma(link = "log")), se = FALSE, color = "black", size = 1)+ theme_classic2() +
  ylab(expression(paste("Cyanobacteria Chl-",italic("a "),"(µg/cm" ^ "2" * ") BenthoTorch"))) + 
  xlab(expression(paste("Avg Extracted Phycocyanin (µg/cm" ^ "2" * ")"))) + labs(fill = "PE detected?") +
  geom_abline(intercept = 0, slope = exp(1), color = "gray", linetype = "dashed", size = 1) + 
  theme(axis.text = element_text(size = 11, color = "black"))
dev.off()
```
---
**Figure 5**
```{r}
glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cayuga)
summary(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cayuga))
  #this relationship is highly significant
residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cayuga))
qqnorm(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cayuga)))
qqline(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cayuga)))
performance::r2(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cayuga))
  # R2 for Generalized Linear Regression : Nagelkerke's R2: 0.641
CYcoef<-coef(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cayuga))[2]
CYcoef #3.15 = exponential slope, so e^3.15 = 23.34


glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Canandaigua)
summary(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Canandaigua))
  #this is also significant but has a negative AIC?
residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Canandaigua))
qqnorm(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data =
                       Canandaigua)))
qqline(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data =
                       Canandaigua)))#only 10 points but perfectly normal
performance::r2(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Canandaigua))
  # R2 for Generalized Linear Regression : Nagelkerke's R2: 0.488

CNcoef<-coef(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Canandaigua))
CNcoef #Exp slope = 1.99, so e^1.99 = 7.32

glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Honeoye)
summary(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Honeoye))
  #stat sig but also has a negative AIC
residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Honeoye))
qqnorm(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Honeoye)))
qqline(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Honeoye)))
performance::r2(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Honeoye))
  # R2 for Generalized Linear Regression : Nagelkerke's R2: 0.286
HNcoef<-coef(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Honeoye))[2]
HNcoef #exp slope = 1.08, so e^1.08 = 2.94
```

```{r}
ggsave("Grayscale BT Cyano Chla and PC data for all samples. Color by lake, linetype by lake.pdf", width = 8, height = 5, units = "in")
ggplot(metadata, aes(x = PC.ug.cm2, y = Cyano.Chla, linetype = Lake)) + 
  geom_point(position = "jitter", shape = 21, aes(fill = as.factor(Lake)), size = 3.5, stroke = 0.5) +
  scale_fill_manual(values = c("black", "gray", "white")) + 
  geom_smooth(method = "glm", method.args = list(family = Gamma(link = "log")), se = FALSE, color = 'black', linewidth = 1) + 
  theme_classic2()+ theme(axis.text = element_text(color = "black", size = 11)) +
  ylab(expression(paste("Cyanobacteria Chl-",italic("a "),"(µg/cm" ^ "2" * ") BenthoTorch"))) + 
  xlab(expression(paste("Avg Extracted Phycocyanin (µg/cm" ^ "2" * ")"))) + labs(fill = "Lake")
dev.off()
```

Figure 5 with log-transformed axes
```{r}
ggsave("LOG - Grayscale BT Cyano Chla and PC data for all samples. Color by lake, linetype by lake.pdf", width = 8, height = 5, units = "in")
ggplot(metadata, aes(x = log(PC.ug.cm2), y = log(Cyano.Chla), linetype = Lake)) + geom_point(position = "jitter", shape = 21, aes(fill = as.factor(Lake)), size = 3.5, stroke = 0.5) + scale_fill_manual(values = c("black", "gray", "white")) + geom_smooth(method = "glm", se = FALSE, color = 'black', linewidth = 1) + theme_classic2()+ theme(axis.text = element_text(color = "black", size = 11)) + ylab(expression(paste("Log Cyanobacteria Chl-",italic("a "),"(µg/cm" ^ "2" * ") BenthoTorch"))) + xlab(expression(paste("Log Avg Extracted Phycocyanin (µg/cm" ^ "2" * ")"))) + labs(fill = "Lake")
dev.off()
```

**Figure 6**
```{r}
ggsave("PC vs BT Cyano Chla for PE detects.pdf", width = 8, height = 5, units = "in")
ggplot(PEdetects, aes(x =PC.ug.cm2, y = Cyano.Chla)) + 
  geom_point(aes(fill = PE.ug.cm2), shape = 21, size = 3.5, color = "black") + 
  scale_fill_distiller(palette = "Reds", direction = 1) +  
  geom_smooth(method = "glm", method.args = list(family = Gamma(link = "log")), se = FALSE, color = 'black', size = 1) + 
  theme_classic2() + xlab(expression(paste("Avg Extracted Phycocyanin (µg/cm" ^ "2" * ")"))) +
  ylab(expression(paste("Cyanobacteria Chl-",italic("a "),"(µg/cm" ^ "2" * ") BenthoTorch"))) +
  labs(fill = expression(paste("Phycoerythrin (µg/cm" ^ "2" * ")")))+ 
  theme(axis.text = element_text(size = 11, color = "black"))+ 
  geom_abline(intercept = 0, slope = exp(1), color = "gray", linetype = "dashed", size = 1)
dev.off()
```

---

**Exploratory analyses**
Subsetting data to determine correlation for samples with < 4 ug/cm2 total Chl-a biomass, as suggested as a change point by Echenique-Subiabre et al. 2016 per spectrophotometry
```{r}
Chla4BT<- metadata %>% filter(Sum.BT.Chla < 4.0)  
nrow(Chla4BT) #78

Chla4F<- metadata %>% filter(Chla.ug.cm2 < 4.0) 
nrow(Chla4F) #52

Chla4all<- Chla4F %>% filter(Sum.BT.Chla < 4.0)
nrow(Chla4all) #51
```
```{r}
glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla4F)
summary(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla4F))
residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla4F))
qqnorm(residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla4F)))
qqline(residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla4F)))
performance::r2(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla4F))# R2 for Generalized Linear Regression
                                     #Nagelkerke's R2: 0.423
Under4slope<- coef(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla4F))[2]
Under4slope  #exponential slope = 0.72
```

Subsetting data to determine correlation for samples with < 2 ug/cm2 total Chl-a biomass
```{r}
Chla2F<- metadata %>% filter(Chla.ug.cm2 < 2.0) 
nrow(Chla2F) #35
```
```{r}
glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla2F)
summary(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla2F))
residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla4F))
qqnorm(residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla2F)))
qqline(residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla2F)))
performance::r2(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla2F))# R2 for Generalized Linear Regression
                                     #Nagelkerke's R2: 0.313
Under2slope<- coef(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = Chla2F))[2]
Under2slope #0.64
```
No, a weaker correlation is found between the two estimates of algal biomass when reducing the dataset to the samples with less than 2 ug/cm2 estimated biomass. 


Investigating a change point in samples with low mass per area
```{r}
LowerMass<- metadata %>% filter(Mass.per.Area.Scraped.g.cm2 <= 0.005) 
nrow(LowerMass) #65

HigherMass<- metadata %>% filter(Mass.per.Area.Scraped.g.cm2 >= 0.005) 
nrow(HigherMass) #16

VeryLowMass<- metadata %>% filter(Mass.per.Area.Scraped.g.cm2 <= 0.0025) 
nrow(VeryLowMass) #48
```
```{r}
glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = LowerMass)
summary(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = LowerMass))
residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = LowerMass))
qqnorm(residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = LowerMass)))
qqline(residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = LowerMass)))
performance::r2(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = LowerMass))# R2 for Generalized Linear Regression
                                     #Nagelkerke's R2: 0.701
LowSlope<- coef(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = LowerMass))[2]
LowSlope  #exponential slope = 0.70
```
```{r}
glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = VeryLowMass)
summary(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = VeryLowMass))
residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = VeryLowMass))
qqnorm(residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = VeryLowMass)))
qqline(residuals(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = VeryLowMass)))
performance::r2(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = VeryLowMass))
# R2 for Generalized Linear Regression
                                     #Nagelkerke's R2: 0.771
VeryLowSlope<- coef(glm(formula = Chla.ug.cm2 ~ Sum.BT.Chla, family = Gamma(link = "log"), data = VeryLowMass))[2]
VeryLowSlope  #exponential slope = 0.59, corresponds to 1.8x increase in extracted PC fluorometry for every 1-unit increase in BenthoTorch cyano Chl-a
```


```{r}
Cyano1BT<- metadata %>% filter(Cyano.Chla < 1.0) # 68
Cyano1F<- metadata %>% filter(PC.ug.cm2 < 1.0) # 71, reviewer suggested we assess this relationship/threshold based on Cyano1F, not Cyano1all
length(metadata$PC.ug.cm2)
Cyano1all<- Cyano1F %>% filter(Cyano.Chla < 1.0)
Cyano1all
nrow(Cyano1all) #58
Cyano1F
```

```{r}
#All samples below 1.0 ug/cm2 threshold for both BenthoTorch and fluorometric estimates
glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cyano1all)
summary(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cyano1all))#this is significant
coeff<-coef(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cyano1all))
coeff #Cyano.Chla exponential slope = 2.84721  #e^2.847 = ~ 17 fold increase n PC with every 1 unit of Cyano Chla by BT
```

```{r}
#Samples below the 1.0 ug/cm2 threshold as determined by in vitro fluorometry
glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cyano1F)
summary(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cyano1F))
residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cyano1F))
qqnorm(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                       Cyano1F)))
qqline(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                       Cyano1F)))
performance::r2(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                      Cyano1F)) #Nagelkerke's R2: 0.13

coeff<-coef(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cyano1F))[2]
coeff #Cyano.Chla exponential slope = 0.86 = 2.36x increase in PC with every 1 unit of Cyano Chla by BT
```
```{r}
#Samples below 1.0 ug/cm2 as determined by BenthoTorch
glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cyano1BT)
summary(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cyano1BT))
coeff<-coef(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = Cyano1BT))[2]
coeff #Cyano.Chla exponential slope = 3.43 = ~ 30X increase in PC with every 1 unit of Cyano Chla by BT
```
```{r}
CyanoF.5<- metadata %>% filter(PC.ug.cm2 < 0.5)
nrow(CyanoF.5) #54, which is 67% of all samples

#Samples below the 0.5 ug/cm2 PC as determined by in vitro fluorometry
glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = CyanoF.5)
summary(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = CyanoF.5))
residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = CyanoF.5))
qqnorm(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                       CyanoF.5)))
qqline(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                       CyanoF.5)))
performance::r2(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                      CyanoF.5)) #Nagelkerke's R2: 0.110

coef.5<-coef(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = CyanoF.5))[2]
coef.5 #exponential slope = 0.52, corresponds to every 1 unit increase in BenthoTorch was 1.68 increase in extracted PC. 
```
0.5 ug cyanobacterial biomass/cm2 is likely the maximum threshold we can propose that supports near a 1:1 relationship (though still does not reach it). 

```{r}
CyanoF.25<- metadata %>% filter(PC.ug.cm2 < 0.25)
nrow(CyanoF.25) #42, which is 52% of all samples

#Samples below the 0.5 ug/cm2 PC as determined by in vitro fluorometry
glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = CyanoF.25)
summary(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = CyanoF.25))
residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = CyanoF.25))
qqnorm(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                       CyanoF.25)))
qqline(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                       CyanoF.25)))
performance::r2(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                      CyanoF.25)) #Nagelkerke's R2: 0.097

coef.25<-coef(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = CyanoF.25))[2]
coef.25 #exponential slope = 0.38, corresponds to every 1 unit increase in BenthoTorch was 1.46 increase in extracted PC
```

```{r}
CyanoF.1<- metadata %>% filter(PC.ug.cm2 < 0.1)
nrow(CyanoF.1) #21, which is 26% of all samples

#Samples below the 0.5 ug/cm2 PC as determined by in vitro fluorometry
glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = CyanoF.1)
summary(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = CyanoF.1))
residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = CyanoF.1))
qqnorm(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                       CyanoF.1)))
qqline(residuals(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                       CyanoF.1)))
performance::r2(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = 
                      CyanoF.1)) #Nagelkerke's R2: 0.000

coef.1<-coef(glm(formula = PC.ug.cm2 ~ Cyano.Chla, family = Gamma(link = "log"), data = CyanoF.1))[2]
coef.1 #exponential slope = 0.024, corresponds to every 1 unit increase in BenthoTorch was 1.02 increase in extracted PC (i.e., a 1:1 relationship between estimates of cyanobacterial biomass was found in samples <0.1 ug/cm2 as estimated by in vitro fluorometry)
```

---
Supplementary
```{r}
#Figure S1
ggsave("Converted light intensity CY and HN.pdf", width = 8, height = 5, units = "in")
ggplot(lightmetadata, aes(x = Depth, y = Conv.Light.cm2)) + geom_boxplot()+
    theme_classic() + facet_wrap(vars(lightmetadata$Lake)) + xlab("") + ylab(expression(paste("Light Intensity (lumens/cm" ^ "2" * ")"))) + theme(axis.text = element_text(color = "black", size = 10))
dev.off()
```

```{r}
#Figure S2
ggsave("Field QC Avg RFU Microcystis and Grateloupia.pdf", width = 7, height = 5, units = "in")
ggplot(AvgFieldQC, aes(x = ID, y = AVG.RFU, fill = Module)) + geom_bar(stat = "identity", position = position_dodge()) + geom_errorbar(aes(ymin = Adj.AVG.RFU - Std.Dev, ymax = Adj.AVG.RFU + Std.Dev), position = position_dodge(0.9), width = 0.8) + scale_fill_manual(values = c("tomato2", "cadetblue2"), labels = c("PE", "PC"))  + labs("Module") + scale_y_break(c(6e+05, 8e+07), scale = 1) + scale_y_break(c(1e+05, 4.7e+05), scale = 0.5) + theme_classic2() + theme(axis.text = element_text(size = 11, color = "black")) + ylab("Avg RFU") + xlab("")
dev.off()
```

```{r}
#Figure S3 with 1.0 threshold line
ggsave("Change point line 1.0_Significant PC vs BT Cyano Chla.pdf", width = 8, height = 5, units = "in")
ggplot(metadata, aes(x =PC.ug.cm2, y = Cyano.Chla)) + geom_point(aes(fill = Perc.Cyano.BT), shape = 21, size = 3, color = "black") +  scale_fill_distiller(palette = "GnBu", direction = 1) + 
  geom_smooth(method = "glm", method.args = list(family = Gamma(link = "log")), se = FALSE, color = "black", size = 1)+
  theme_classic2() + 
  ylab(expression(paste("Cyanobacteria Chl-",italic("a "),"(µg/cm" ^ "2" * ") BenthoTorch"))) +
  xlab(expression(paste("Avg Extracted Phycocyanin (µg/cm" ^ "2" * ")"))) + labs(fill = "% Cyanobacteria") + 
  geom_abline(intercept = 0, slope = exp(1.0), color = "gray", linetype = "dashed", size = 1) + 
  geom_point(data = Cyano1F, aes(x =PC.ug.cm2, y = Cyano.Chla, fill = Perc.Cyano.BT), shape = 21, size = 3, color = "black") + 
  geom_smooth(data = Cyano1F, aes(x =PC.ug.cm2, y = Cyano.Chla), method = "glm", method.args = list(family = Gamma(link = "log")), color = "black", linetype = "dotdash", size = 1, se = FALSE) + 
  theme(axis.text = element_text(size = 11, color = "black"))
dev.off()
```

```{r}
#Figure S3 with 0.5 line instead of 1.0 threshold
ggsave("Change point line 0.5_Significant PC vs BT Cyano Chla.pdf", width = 8, height = 5, units = "in")
ggplot(metadata, aes(x =PC.ug.cm2, y = Cyano.Chla)) + geom_point(aes(fill = Mass.per.Area.Scraped.g.cm2), shape = 21, size = 3, color = "black") +  scale_fill_distiller(palette = "Greens", direction = 1) + 
  geom_smooth(method = "glm", method.args = list(family = Gamma(link = "log")), se = FALSE, color = "black", size = 1)+
  theme_classic2() + 
  ylab(expression(paste("Cyanobacteria Chl-",italic("a "),"(µg/cm" ^ "2" * ") BenthoTorch"))) + 
  xlab(expression(paste("Avg Extracted Phycocyanin (µg/cm" ^ "2" * ")"))) + 
  labs(fill = expression(paste("Periphyton (g/cm" ^ "2"* ")"))) + 
  geom_abline(intercept = 0, slope = exp(1.0), color = "gray", linetype = "dashed", size = 1) + 
  geom_point(data = CyanoF.5, aes(x =PC.ug.cm2, y = Cyano.Chla, fill = Mass.per.Area.Scraped.g.cm2), shape = 21, size = 3, color = "black") + 
  geom_smooth(data = CyanoF.5, aes(x =PC.ug.cm2, y = Cyano.Chla), method = "glm", method.args = list(family = Gamma(link = "log")), color = "black", linetype = "dotdash", size = 1, se = FALSE) + 
  theme(axis.text = element_text(size = 11, color = "black"))
dev.off()
```
```{r}
#Figure S3 with 0.5 and 1.0 lines instead of 1.0 threshold and model summary annotations
ggsave("Both change point lines 0.5 and 1.0_Significant PC vs BT Cyano Chla.pdf", width = 8, height = 5, units = "in")
ggplot(metadata, aes(x =PC.ug.cm2, y = Cyano.Chla)) + geom_point(aes(fill = Mass.per.Area.Scraped.g.cm2), shape = 21, size = 3, color = "black") +  scale_fill_distiller(palette = "Greens", direction = 1) + 
  geom_smooth(method = "glm", method.args = list(family = Gamma(link = "log")), se = FALSE, color = "black", size = 1)+
  theme_classic2() + 
  ylab(expression(paste("Cyanobacteria Chl-",italic("a "),"(µg/cm" ^ "2" * ") BenthoTorch"))) + 
  xlab(expression(paste("Avg Extracted Phycocyanin (µg/cm" ^ "2" * ")"))) + 
  labs(fill = expression(paste("Periphyton (g/cm" ^ "2"* ")"))) + 
  geom_abline(intercept = 0, slope = exp(1.0), color = "gray", linetype = "dashed", size = 1) + 
  geom_point(data = CyanoF.5, aes(x =PC.ug.cm2, y = Cyano.Chla, fill = Mass.per.Area.Scraped.g.cm2), shape = 21, size = 3, color = "black") + 
  geom_smooth(data = CyanoF.5, aes(x =PC.ug.cm2, y = Cyano.Chla), method = "glm", method.args = list(family = Gamma(link = "log")), color = "black", linetype = "longdash", size = 1, se = FALSE) + 
  geom_point(data = Cyano1F, aes(x =PC.ug.cm2, y = Cyano.Chla, fill = Mass.per.Area.Scraped.g.cm2), shape = 21, size = 3, color = "black") + 
  geom_smooth(data = Cyano1F, aes(x =PC.ug.cm2, y = Cyano.Chla), method = "glm", method.args = list(family = Gamma(link = "log")), color = "black", linetype = "dotdash", size = 1, se = FALSE) +
  theme(axis.text = element_text(size = 11, color = "black")) +
  annotate("text", label = "<0.5 µg in vitro", x = 0.91, y = 1.25, size = 3.5) +
  annotate("text", label = "<1.0 µg in vitro", x = 1.3, y = 1, size = 3.5)
dev.off()
```
